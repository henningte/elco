---
output: github_document
bibliography: "./inst/REFERENCES.bib"
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures"
)
# Please put your title here to include it in the file below.
Title <- "Title of your paper goes here"
```

# elco

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
<!-- badges: end -->

## Overview

'elco' extends the ['units'](https://r-quantities.github.io/units/) R package with measurement units specific for chemical elements. This allows to consider the identity of chemical elements in calculations with measurement units. 

'elco' defines units such as g$_\text{C}$ (grams of carbon) and helps to avoid erroneous calculations, such as $\frac{1~\text{g}_\text{C}  \cdot \text{mol}_\text{N}}{`r PeriodicTable::mass("N")`~\text{g}_\text{N}} = `r round(1/PeriodicTable::mass("N"), 2)`~\text{mol}_\text{C}$. 

In addition, 'elco' provides the following functions: 

1. `elco_convert()`: batch-conversion of elemental contents in data frames (e.g. from g to mol). 
2. `elco_nosc()`, `elco_or()`, `elco_du()`: Compute the nominal oxidation state of carbon, oxidative ratio, and degree of unsaturation, respectively (see e.g., @Worrall.2016b, @Masiello.2008).


### How to install

'elco' can be installed from GitHub:

```{r, eval = FALSE}
remotes::install_github("henningte/elco")
```


### How to use

Here is a quick overview on how 'elco' helps with computing elemental ratios.

```{r, mesage = FALSE, warning=FALSE}
library(elco)

# load other required packages
library(dplyr)
library(magrittr)
```


First, we have a short look at the sample data and its structure:

```{r}
d <- elco::chno
d
```

Contents for one element are stored in a numeric vector. Measurement units and errors are tracked using the [quantities](https://github.com/r-quantities/quantities) package.

elco supports unit conversion (using the functions of the units package):

```{r}
# g_C/g_sample to mol_C/g_sample (umol_C/g_sample)
units::set_units(d$C, value = "mol_C/g_sample", mode = "standard")
units::set_units(d$C, value = "umol_C/g_sample", mode = "standard")
```


`elco_convert()` can be used to batch-convert units. This will convert the numerator of the unit while it keeps the denominator. For example, here we convert g_C/g_sample to mmol_C/g_sample (and similarly for all other elements in `d`):

```{r}
# g/g to mol
d %>% 
  dplyr::mutate(
    dplyr::across(
      ! dplyr::all_of("sample_mass"), 
      \(.x) elco_convert(.x, to = "mmol"))
  )
```

elco helps computing element ratios:

```{r}
d %>%
  dplyr::mutate(
    cn_molar = elco_convert(C, to = "mol") / elco_convert(N, to = "mol")
  )
```

Finally, elco provides functions to compute the nominal oxidation state of carbon (NOSC), oxidative ratio (OR), and degree of unsaturation (DU) [@Worrall.2016b; @Masiello.2008]

```{r}
d <- 
  d %>% 
  dplyr::mutate(
    dplyr::across(
      ! dplyr::all_of("sample_mass"),
      function(.x) elco_convert(.x * sample_mass, to = "mol")
    )
  ) %>%
  dplyr::mutate(
    nosc = elco_nosc(C = C, H = H, N = N, O = O),
    or = elco_or(C = C, H = H, N = N, O = O),
    du = elco_du(C = C, H = H, N = N)
  )
```


### How to cite

Please cite this package as:

> Teickner, H. and Knorr, K.-H., (`r format(Sys.Date(), "%Y")`). _elco: Handling data on chemical element contents and isotope signatures_. Accessed `r format(Sys.Date(), "%d %b %Y")`. Online at <https://github.com/henningte/elco>

### Licenses

**Text and figures :**  [CC-BY-4.0](http://creativecommons.org/licenses/by/4.0/)

**Code :** See the [DESCRIPTION](DESCRIPTION) file

**Data :** [CC-BY-SA-4.0](https://creativecommons.org/licenses/by-sa/4.0/deed.en).

### Contributions

We welcome contributions from everyone. Before you get started, please see our [contributor guidelines](CONTRIBUTING.md). Please note that this project is released with a [Contributor Code of Conduct](CONDUCT.md). By participating in this project you agree to abide by its terms.

### Sources

Conversion constants between masses and molar amounts of chemical elements are from [PeriodicTable](https://github.com/cran/PeriodicTable).

